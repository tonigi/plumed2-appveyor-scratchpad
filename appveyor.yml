# image
image: Visual Studio 2022

# build platform
platform: x64

init:
  - ps: Set-WinUserLanguageList -Force 'it-IT'
  - cmd: call \miniconda38-x64\scripts\activate
  - cmd: conda info

clone_script:
  - cmd: |
      cd
      git clone --depth=5 https://github.com/plumed/plumed2.git
      git clone https://github.com/tonigi/plumed-feedstock.git

#  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:  
  - cmd: conda install -y -c tonigi plumed
  
build_script:
  - cmd: |
      cd
      conda install -y conda-build
      cd plumed-feedstock
      dir recipe
#      conda build recipe
  
test_script:
  - cmd: |
      conda install -y -c conda-forge m2-base make m2-sed m2-diffutils
      set PLUMED_ROOT=%CONDA_PREFIX%\lib\plumed
      cd plumed2\regtest\basic
      make
      
artifacts:
  - path: '**\report.txt'
    name: regtest_reports


on_finish:
  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

